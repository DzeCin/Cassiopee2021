<!DOCTYPE html>
<html lang="fr">

<head>
  <!-- 2020-09-21 Mon 15:21 -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>TP n¬∞1 - Prise en main de PHP et de la bo√Æte √† outils Symfony</title>
  <meta name="generator" content="Org mode">
  <meta name="author" content="Olivier Berger (TSP)">
  <meta name="description" content="CSC4101 Telecom SudParis - 2018-2019 - TP n¬∞1">
  <style type="text/css">
    <!--/*
    -->
  <![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
  </style>
  <meta name="copyright" content="&copy; 2017 Telecom SudParis + Olivier Berger" />
  <link rel="stylesheet" type="text/css" href="../media/tsp.css" />
  <style type="text/css">
    .floatrightclass {
      float: right;
      margin: 0 0 10px 10px;
    }

    .floatleftclass {
      float: left;
      margin: 0 0 10px 10px;
    }

    .clearrightclass {
      clear: right;
    }

    .clearleftclass {
      clear: left;
    }
  </style>
  <script type="text/javascript" src='../media/tsp.js'></script>
  <script type="text/javascript" src="../media/org-info-src.js"></script>
  <script type="text/javascript">
    /* <![CDATA[ */
    org_html_manager.set("TOC_DEPTH", "2");
    org_html_manager.set("LINK_HOME", "");
    org_html_manager.set("LINK_UP", "");
    org_html_manager.set("LOCAL_TOC", "0");
    org_html_manager.set("VIEW_BUTTONS", "0");
    org_html_manager.set("MOUSE_HINT", "#cccccc");
    org_html_manager.set("FIXED_TOC", "0");
    org_html_manager.set("TOC", "1");
    org_html_manager.set("VIEW", "showall");
    org_html_manager.set("HELP", "1");
    org_html_manager.setup();
/* ]]> */
  </script>
  <script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2019 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
< !--/*--><![CDATA[/*><!--*/
      function CodeHighlightOn(elem, id) {
        var target = document.getElementById(id);
        if (null != target) {
          elem.cacheClassElem = elem.className;
          elem.cacheClassTarget = target.className;
          target.className = "code-highlighted";
          elem.className = "code-highlighted";
        }
      }
    function CodeHighlightOff(elem, id) {
      var target = document.getElementById(id);
      if (elem.cacheClassElem)
        elem.className = elem.cacheClassElem;
      if (elem.cacheClassTarget)
        target.className = elem.cacheClassTarget;
    }
/*]]>*///-->
  </script>
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
  <script type="text/javascript"
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
</head>

<body>
  <div id="content">
    <h1 class="title">TP n¬∞1 - Prise en main de PHP et de la bo√Æte √† outils Symfony
      <br>
      <span class="subtitle">Application PHP en ligne de commande</span>
    </h1>
    <div id="table-of-contents">
      <h2>Table des mati√®res</h2>
      <div id="text-table-of-contents">
        <ul>
          <li><a href="#org3df7f92">Introduction</a>
            <ul>
              <li><a href="#orga213d55">Pr√©requis</a></li>
            </ul>
          </li>
          <li><a href="#org65ed802">√âtape 1 : Prise en main de l&rsquo;environnement d&rsquo;ex√©cution PHP en ligne de
              commande pour Symfony</a>
            <ul>
              <li><a href="#orgd6e44e4">Contexte : Syst√®me d&rsquo;exploitation utilis√©</a></li>
              <li><a href="#orgf2b423a">√âtape 1-a : v√©rification de l&rsquo;environnement de mise au point PHP</a></li>
              <li><a href="#orgf39bcaa">√âtape 1-b : cr√©ation de l&rsquo;environnement de travail dans le compte DISI</a>
              </li>
              <li><a href="#orgb66e0d6">√âtape 1-c : d√©couverte de Composer</a></li>
              <li><a href="#org59566be">√âtape 1-d : ligne de commande Symfony</a></li>
            </ul>
          </li>
          <li><a href="#org7709e65">√âtape 2 : R√©alisation du &laquo;&nbsp;Portage&nbsp;&raquo; du MiniAllocin√©</a>
            <ul>
              <li><a href="#org263c994">Mod√®le des donn√©es</a></li>
              <li><a href="#orgedd312c">√âtape 2-a : Configuration de l&rsquo;environnement de d√©veloppement</a>
                <ul>
                  <li><a href="#org0c1e47f">Ajout des modules PHP utiles</a></li>
                  <li><a href="#org4c7371b"><span class="todo TODO">TODO</span> Chargement dans l&rsquo;IDE Eclipse</a>
                  </li>
                  <li><a href="#orgffef1e9">Configuration du projet pour les tests</a></li>
                </ul>
              </li>
              <li><a href="#org7d9c2a4">√âtape 2-b : Ajout entit√© &laquo;&nbsp;Film&nbsp;&raquo;</a></li>
              <li><a href="#org23c69ca">√âtape 2-c : Ajout entit√© Recommendation</a></li>
              <li><a href="#org16d203c">√âtape 2-d : Observation du code PHP g√©n√©r√©</a></li>
              <li><a href="#org0e2b778">√âtape 2-e : Cr√©ation de la base de donn√©es</a></li>
              <li><a href="#org88c9be3">√âtape 2-f : Ajout du chargement de donn√©es de test</a></li>
              <li><a href="#orgd6aa279">√âtape 2-g : Ajout de la persistence en <i>cascade</i></a></li>
              <li><a href="#org539172d">√âtape 2-h : V√©rification du contenu de la base de donn√©es</a></li>
            </ul>
          </li>
          <li><a href="#org3481d98">√âtape 3 : Ajout interface console</a>
            <ul>
              <li><a href="#orga3db0cb">√âtape 3-a : Ajout de la commande <code>app:list-films</code></a></li>
              <li><a href="#org2aa746b">√âtape 3-b : Branchement de l&rsquo;interface √† la base de donn√©es</a></li>
              <li><a href="#org75dda17">√âtape 3-c : Ajout de l&rsquo;affichage de la liste des films</a></li>
              <li><a href="#org606d89a">√âtape 3-d : Ajout de Film::__toString()</a></li>
            </ul>
          </li>
          <li><a href="#orgf7bc592">√âtape 4 : Am√©lioration de notre application</a>
            <ul>
              <li><a href="#org318dc5d">√âtape 4-a : Ajout de l&rsquo;affichage des recommendations d&rsquo;un film</a>
              </li>
              <li><a href="#orgeec2331">√âtape 4-b : Am√©lioration des fonctionnalit√©s</a>
                <ul>
                  <li><a href="#org60b0f0b">Affichage des films d&rsquo;une ann√©e</a></li>
                  <li><a href="#org4a591bc">D√©doublonage des <i>remakes</i></a></li>
                </ul>
              </li>
              <li><a href="#orgf86de9c">Ajout contr√¥leur Web ?</a></li>
            </ul>
          </li>
          <li><a href="#orgaea2b8b">√âvaluation</a></li>
        </ul>
      </div>
    </div>

    <div id="outline-container-org3df7f92" class="outline-2">
      <h2 id="org3df7f92">Introduction</h2>
      <div class="outline-text-2" id="text-org3df7f92">
        <div class="objectif">
          <p>
            Cette s√©ance permet de familiariser les √©tudiants avec
            l&rsquo;<b>environnement de programmation PHP</b> et de mise au
            point bas√© sur <b>Symfony</b>, pour l&rsquo;√©criture de programmes
            interactifs en PHP lanc√©s en <b>ligne de commande</b>.
          </p>

        </div>
      </div>

      <div id="outline-container-orga213d55" class="outline-3">
        <h3 id="orga213d55">Pr√©requis</h3>
        <div class="outline-text-3" id="text-orga213d55">
          <p>
            On consid√®re que vous avez acquis les notions de base du langage PHP
            dans la s√©quence de Travail en Autonomie qui pr√©c√®de cette s√©ance.
          </p>
        </div>
      </div>
    </div>


    <div id="outline-container-org65ed802" class="outline-2">
      <h2 id="org65ed802">√âtape 1 : Prise en main de l&rsquo;environnement d&rsquo;ex√©cution PHP en ligne de commande
        pour Symfony</h2>
      <div class="outline-text-2" id="text-org65ed802">
        <div class="objectif">
          <p>
            Cette √©tape consiste √† prendre en main l&rsquo;environnement d&rsquo;ex√©cution de
            PHP en ligne de commande, ainsi que certains outils de mise au point
            pour le <i>framework</i> Symfony
          </p>

        </div>
      </div>

      <div id="outline-container-orgd6e44e4" class="outline-3">
        <h3 id="orgd6e44e4">Contexte : Syst√®me d&rsquo;exploitation utilis√©</h3>
        <div class="outline-text-3" id="text-orgd6e44e4">
          <p>
            L&rsquo;environnement de travail n√©cessaire sera :
          </p>
          <ul class="org-ul">
            <li><b>l&rsquo;environnement Unix des comptes DISI des √©tudiants, en salles de
                travaux pratiques, pour les √©tudiants en pr√©sentiel</b>;</li>
            <li>compl√©t√© √©ventuellement par un environnement Unix (p. ex. en machine
              virtuelle, ou terminal de ligne de commande sous Windows), pour les
              √©tudiants qui travaillent √† distance (ou en pr√©sentiel) sur leurs machines personnelles.</li>
          </ul>

          <div class="attention">
            <p>
              Les copies d&rsquo;√©crans et autres sp√©cificit√©s refl√®tent autant que
              possible l&rsquo;√©tat des versions install√©es sur les machines DISI des
              salles de TP.<br>
              <br>
              Il est probable que sur les machines individuelles, le support de PHP
              et de Symfony sera parfois diff√©rent.<br>
              <br>
              M√™me si les technologies utilis√©es pour les s√©quences d&rsquo;apprentissage
              actif (programmation PHP avec le <i>framework</i> Symfony) sont
              th√©oriquement portables et utilisables sur diff√©rents syst√®mes
              d&rsquo;exploitation, des diff√©rences existent qui rendent parfois difficile le
              support au vu des diff√©rentes variantes possibles, et pour un module enseign√©
              en promo enti√®re.
              <br>
              L&rsquo;√©quipe p√©dagogique ne sera pas en mesure de garantir le support relatif aux outils
              pour tous les syst√®mes d&rsquo;exploitation, mais nous ferons de notre mieux
              pour vous accompagner.
            </p>

          </div>
        </div>
      </div>

      <div id="outline-container-orgf2b423a" class="outline-3">
        <h3 id="orgf2b423a">√âtape 1-a : v√©rification de l&rsquo;environnement de mise au point PHP</h3>
        <div class="outline-text-3" id="text-orgf2b423a">
          <div class="objectif">
            <p>
              Disposer des outils n√©cessaires au reste de la s√©ance.
            </p>

          </div>

          <ol class="org-ol">
            <li>
              <p>
                V√©rifiez que la commande <code>composer</code> est pr√©sente sur votre
                installation de PHP (la version ci-dessous n&rsquo;est pas strictement
                n√©cessaire, du moment qu&rsquo;une version r√©cente de composer est
                pr√©sente<sup><a id="fnr.1" class="footref" href="#fn.1">1</a></sup>) :
              </p>
              <div class="org-src-container">
                <pre class="src src-sh">composer -V
</pre>
              </div>

              <pre class="example">
Composer version 1.8.4 2019-02-11 10:52:10
</pre>
            </li>

            <li>
              <p>
                V√©rifiez que l&rsquo;interpr√©teur PHP en ligne de commande est pr√©sent,
                et que la version de PHP install√©e est sup√©rieure ou √©gale √†
                7.1.3 :
              </p>

              <div class="org-src-container">
                <pre class="src src-sh">php -v
</pre>
              </div>

              <pre class="example">
PHP 7.2.16 (cli) (built: Mar  5 2019 11:05:59) ( NTS )
Copyright (c) 1997-2018 The PHP Group
Zend Engine v3.2.0, Copyright (c) 1998-2018 Zend Technologies
    with Xdebug v2.6.1, Copyright (c) 2002-2018, by Derick Rethans
</pre>
            </li>

            <li>V√©rifiez que les modules XML et SQLite3 pour PHP sont bien pr√©sents
              dans l&rsquo;interpr√©teur :

              <ul class="org-ul">
                <li>
                  <p>
                    Tapez la commande suivante :
                  </p>
                  <div class="org-src-container">
                    <pre class="src src-sh">php -m | grep xml
</pre>
                  </div>

                  <p>
                    Vous devriez voir appara√Ætre, notamment, <code>xml</code><sup><a id="fnr.2" class="footref"
                        href="#fn.2">2</a></sup>.
                  </p>
                </li>

                <li>
                  <p>
                    Tapez √©galement la commande :
                  </p>

                  <div class="org-src-container">
                    <pre class="src src-sh">php -m | grep sqlite
</pre>
                  </div>

                  <p>
                    Vous devriez voir appara√Ætre, notamment, <code>sqlite3</code><sup><a id="fnr.3" class="footref"
                        href="#fn.3">3</a></sup>.
                  </p>
                </li>
              </ul>
            </li>
          </ol>
        </div>
      </div>



      <div id="outline-container-orgf39bcaa" class="outline-3">
        <h3 id="orgf39bcaa">√âtape 1-b : cr√©ation de l&rsquo;environnement de travail dans le compte DISI</h3>
        <div class="outline-text-3" id="text-orgf39bcaa">
          <div class="objectif">
            <p>
              L&rsquo;objectif de cette √©tape est de cr√©er l&rsquo;environnement n√©cessaire au
              travail sur l&rsquo;application en PHP.
            </p>

          </div>

          <ol class="org-ol">
            <li>
              <p>
                Configurez un r√©pertoire de travail <code>$HOME/CSC4101/</code> dans votre
                compte Unix (DISI), dans lequel vous travaillerez.
              </p>

              <div class="org-src-container">
                <pre class="src src-sh">mkdir $<span style="color: #a0522d;">HOME</span>/CSC4101/
<span style="color: #483d8b;">cd</span> $<span style="color: #a0522d;">HOME</span>/CSC4101/
</pre>
              </div>
            </li>

            <li>
              <p>
                Pour l&rsquo;instant, nous vous sugg√©rons de travailler, pour chaque
                s√©ance, dans un r√©pertoire sp√©cifique :
              </p>
              <ul class="org-ul">
                <li><code>$HOME/CSC4101/</code>
                  <ul class="org-ul">
                    <li><code>tp-01/</code></li>
                    <li><code>tp-02/</code></li>
                    <li>&#x2026;</li>
                  </ul>
                </li>
              </ul>

              <div class="org-src-container">
                <pre class="src src-sh">mkdir tp-01/
<span style="color: #483d8b;">cd</span> tp-01/
</pre>
              </div>
            </li>
          </ol>

          <p>
            En cas d&rsquo;utilisation de machine personnelle permettant √† chacun des
            membres du bin√¥me de travailler en parall√®le durant les TPs,
            assurez-vous d&rsquo;avoir n√©anmoins une copie des outils et codes utilis√©s
            sur les comptes DISI des deux membres du bin√¥me (en cas de panne /
            perte / vol de la machine personnelle).
          </p>

          <div class="attention">
            <p>
              Le travail effectu√© sur l&rsquo;application &laquo;&nbsp;fil-rouge&nbsp;&raquo; <code>ToDo</code> sera
              incr√©mental au fur et √† mesure des s√©ances, donc il sera de votre
              responsabilit√© de garder une trace, chez chacun des membres du bin√¥me,
              de la progression effectu√©e ensemble en TP.
            </p>

          </div>
        </div>
      </div>

      <div id="outline-container-orgb66e0d6" class="outline-3">
        <h3 id="orgb66e0d6">√âtape 1-c : d√©couverte de Composer</h3>
        <div class="outline-text-3" id="text-orgb66e0d6">
          <div class="objectif">
            <p>
              L&rsquo;objectif de cette s√©quence est d&rsquo;examiner les
              fonctionnalit√©s de type ligne de commande fournies par la <i>console</i>
              Symfony, pour les d√©veloppeurs
            </p>

          </div>

          <p>
            Vous allez utiliser la commande <code>create-project</code> de composer, qui va cr√©er le r√©pertoire de
            d√©veloppement d&rsquo;une application Symfony et y t√©l√©charger le code
            source d&rsquo;un squelette d&rsquo;application.
          </p>

          <ol class="org-ol">
            <li>
              <p>
                T√©l√©chargez, avec l&rsquo;outil Composer, le squelette d&rsquo;application sur
                lequel vous allez travailler dans la suite de la s√©ance :
              </p>
              <div class="org-src-container">
                <pre class="src src-sh"><span style="color: #483d8b;">cd</span> $<span style="color: #a0522d;">HOME</span>/CSC4101/tp-01/
composer create-project -s stable symfony/skeleton miniallocine ~4
</pre>
              </div>

              <p>
                Voici la signification des arguments :
              </p>
              <dl class="org-dl">
                <dt>create-project</dt>
                <dd>commande <code>create-project</code> de composer
                  (cf. <a href="https://getcomposer.org/doc/03-cli.md#create-project">documentation composer</a>)</dd>

                <dt>symfony/skeleton</dt>
                <dd>r√©f√©rence du squelette
                  d&rsquo;application standard d&rsquo;application Web pour la version 4
                  de Symfony</dd>

                <dt>-s stable</dt>
                <dd>choix d&rsquo;une version stable du squelette</dd>

                <dt>miniallocine</dt>
                <dd><b>r√©pertoire de d√©veloppement</b> Symfony √† cr√©er</dd>

                <dt><code>~4</code></dt>
                <dd>version du squelette &gt;= 4 et &lt; 5</dd>
              </dl>

              <div class="remarque">
                <p>
                  Ignorez les √©ventuels messages affich√©s √† la fin de l&rsquo;installation
                  (&laquo;&nbsp;<i>What&rsquo;s next?</i>&nbsp;&raquo; , &laquo;&nbsp;<i>Database
                    Configuration</i>&nbsp;&raquo; et &laquo;&nbsp;<i>How to test?</i>&nbsp;&raquo;)
                  qui ne sont pas pertinents dans notre contexte, pour l&rsquo;instant.
                </p>

              </div>
            </li>

            <li>V√©rifiez les messages affich√©s par Composer sur la sortie standard :

              <ol class="org-ol">
                <li>Identifiez la ligne &laquo;&nbsp;<code>Created project in ...</code>&nbsp;&raquo;</li>

                <li>Identifiez le nombre de paquetages install√©s par composer</li>
              </ol>
            </li>

            <li>
              <p>
                V√©rifiez le contenu du r√©pertoire <b><code>miniallocine</code></b> du projet Symfony qui vient
                d&rsquo;√™tre cr√©√©. Pour l&rsquo;instant, rep√©rez les √©l√©ments principaux qui vont nous int√©resser :
              </p>

              <div class="org-src-container">
                <pre class="src src-sh">ls miniallocine/
</pre>
              </div>

              <pre class="example">
bin  composer.json  composer.lock  config  public  src  symfony.lock  var  vendor
</pre>


              <dl class="org-dl">
                <dt><code>composer.json</code></dt>
                <dd>
                  <p>
                    descriptif du projet Composer de l&rsquo;application Symfony. Il r√©f√©rence notamment les
                    biblioth√®ques PHP utilis√©es;
                  </p>

                  <p>
                    Vous pouvez consulter son contenu dans un √©diteur de textes
                    (format JSON). Au cours de la vie du projet Symfony on pourra
                    y ajouter des d√©pendances du projet pour effectuer le
                    t√©l√©chargement des biblioth√®ques de d√©veloppement additionnelles dont on aura besoin.
                  </p>
                </dd>

                <dt><code>bin/console</code></dt>
                <dd>
                  <p>
                    script ex√©cutable PHP pr√©sent dans le
                    sous-r√©pertoire <code>bin/</code>, utilis√© en ligne de commande
                    pour le d√©veloppement Symfony;
                  </p>

                  <p>
                    Vous le trouverez via :
                  </p>
                  <div class="org-src-container">
                    <pre class="src src-sh">ls -l miniallocine/bin/
</pre>
                  </div>
                </dd>

                <dt><code>src/</code></dt>
                <dd>sources du squelette d&rsquo;application Symfony. Il contient
                  le code PHP de base de l&rsquo;application sur laquelle vous travaillerez par la suite;</dd>

                <dt><code>vendor/</code></dt>
                <dd>contient le code de toutes les biblioth√®ques PHP du
                  <i>framework</i> Symfony qui seront utilis√©es. Elles ont
                  √©t√© t√©l√©charg√©es par composer.
                </dd>
              </dl>
            </li>

            <li>
              <p>
                V√©rifiez que tous les paquetages sont √† jour
              </p>

              <div class="org-src-container">
                <pre class="src src-sh"><span style="color: #483d8b;">cd</span> miniallocine
composer update
</pre>
              </div>

              <pre class="example">
Loading composer repositories with package information
Updating dependencies (including require-dev)
Restricting packages listed in "symfony/symfony" to "4.4.*"
Nothing to install or update
Generating autoload files
Executing script cache:clear [OK]
Executing script assets:install public [OK]
</pre>

              <p>
                Cette commande pourra √™tre utilis√©e pour mettre √† jour les
                paquetages dont d√©pend l&rsquo;application (selon les sp√©cifications
                d√©finies dans le fichier <code>composer.json</code>). Pour l&rsquo;instant, comme
                les derni√®res versions des paquetages viennent juste d&rsquo;√™tre
                t√©l√©charg√©es (dans <code>vendor/</code>) il ne devrait rien y avoir √† re-t√©l√©charger.
              </p>
            </li>
          </ol>
        </div>
      </div>

      <div id="outline-container-org59566be" class="outline-3">
        <h3 id="org59566be">√âtape 1-d : ligne de commande Symfony</h3>
        <div class="outline-text-3" id="text-org59566be">
          <div class="objectif">
            <p>
              L&rsquo;objectif de cette s√©quence est d&rsquo;examiner les
              fonctionnalit√©s de type ligne de commande fournies par la <i>console</i>
              Symfony, pour les d√©veloppeurs
            </p>

          </div>

          <p>
            La commande <code>bin/console</code> fournie propose d&rsquo;acc√©der en ligne de commande
            √† diff√©rentes fonctionnalit√©s du cadriciel Symfony, notamment des
            utilitaires int√©ressants pour les phases de d√©veloppement et de tests.
          </p>

          <p>
            <b>Essayez les commandes suivantes dans un terminal, depuis l&rsquo;int√©rieur du r√©pertoire du projet
              Symfony :</b>
          </p>

          <ol class="org-ol">
            <li>
              <p>
                V√©rifiez la version de Symfony utilis√©e dans le projet
              </p>
              <div class="org-src-container">
                <pre class="src src-sh"><span style="color: #483d8b;">cd</span> $<span style="color: #a0522d;">HOME</span>/CSC4101/tp-01/miniallocine/
bin/console -V
</pre>
              </div>

              <pre class="example">
Symfony 4.4.13 (env: dev, debug: true)
</pre>


              <p>
                Vous √™tes en environnement de d√©veloppement <code>dev</code> (pas encore pr√™ts pour la prod !)
              </p>
            </li>

            <li>
              <p>
                Affichez la liste des sous-commandes disponibles (avec la sous-commande
                <code>list</code>, ou directement sans argument pass√© √† <code>bin/console</code>) :
              </p>
              <div class="org-src-container">
                <pre class="src src-shell">bin/console [list]
</pre>
              </div>
            </li>
            <li>
              <p>
                Consultez l&rsquo;aide en ligne avec la sous-commande <code>help</code>. Par exemple :
              </p>
              <div class="org-src-container">
                <pre class="src src-shell">bin/console help about
</pre>
              </div>
            </li>
            <li>
              <p>
                Et consultez donc √©galement la sortie fournie par cette sous-commande <code>about</code> :
              </p>
              <div class="org-src-container">
                <pre class="src src-shell">php bin/console about
</pre>
              </div>

              <p>
                Cette commande donne diff√©rentes informations sur l&rsquo;environnement de d√©veloppement et de mise au
                point.
              </p>
            </li>
          </ol>
        </div>
      </div>
    </div>


    <div id="outline-container-org7709e65" class="outline-2">
      <h2 id="org7709e65">√âtape 2 : R√©alisation du &laquo;&nbsp;Portage&nbsp;&raquo; du MiniAllocin√©</h2>
      <div class="outline-text-2" id="text-org7709e65">
        <div class="objectif">
          <p>
            Cette √©tape va permettre de d√©velopper une premi√®re mini-application
            en PHP avec Symfony, permettant de consulter des recommendations de films.
          </p>

        </div>

        <p>
          On va reprendre la petite application &laquo;&nbsp;Mini-Allocin√©&nbsp;&raquo; √©tudi√©e dans le
          module CSC 3101 (Algorithmique et langage de programmation), et en
          r√©aliser une version en PHP.
        </p>

        <p>
          Pour m√©moire, il s&rsquo;agissait de &laquo;&nbsp;concevoir un petit serveur Web
          fournissant des informations cin√©matographiques. [&#x2026;] nous ne nous
          occupons que de deux fonctionnalit√©s : celle permettant d&rsquo;acc√©der √† la
          liste des films g√©r√©s par le site et celle permettant de lire les avis
          que des utilisateurs ont d√©pos√© sur un film&nbsp;&raquo;
        </p>
      </div>

      <div id="outline-container-org263c994" class="outline-3">
        <h3 id="org263c994">Mod√®le des donn√©es</h3>
        <div class="outline-text-3" id="text-org263c994">
          <p>
            Comme dans l&rsquo;application Java du Mini-Allocin√©, on souhaite g√©rer des
            <b>Films</b> et leurs <b>Recommendations</b>.
          </p>

          <p>
            Dans notre application, on va g√©rer ces √©l√©ments aussi bien dans la
            base de donn√©es relationnelle, qui stockera les donn√©es entre deux
            ex√©cutions de notre programme, qu&rsquo;en m√©moire durant l&rsquo;ex√©cution du
            programme PHP.
          </p>

          <p>
            On va g√©rer les structures de donn√©es en s&rsquo;appuyant :
          </p>
          <ul class="org-ul">
            <li>sur le mod√®le relationnel (√©tudi√© en CSC3601), pour le stockage dans
              la base de donn√©es.</li>
            <li>sur le mod√®le objet (√©tudi√© en CSC4101), pour la repr√©sentation en
              m√©moire.</li>
          </ul>

          <p>
            En base de donn√©es, on aura donc deux relations :
          </p>
          <ul class="org-ul">
            <li><code>Film</code></li>
            <li><code>Recommendation</code></li>
          </ul>
          <p>
            Les deux seront li√©es par une association 1-n : &laquo;&nbsp;un film a plusieurs
            recommendations / une recommendation porte sur un film&nbsp;&raquo;. Une cl√©
            √©trang√®re permettra d&rsquo;enregistrer, dans la table des recommendations,
            l&rsquo;identifiant du film sur lequel elle porte.
          </p>

          <p>
            Du c√¥t√© objet en m√©moire, on utilisera ici la biblioth√®que PHP <b>Doctrine</b>,
            qui est un ORM (<i>Object Relational Mapper</i>). Son r√¥le est de permettre
            la gestion de collections d&rsquo;objets, d&rsquo;associations entre entit√©s, et
            de fournir le chargement/sauvegarde des objets depuis la base de
            donn√©es.
          </p>

          <p>
            On reviendra plus en d√©tail sur Doctrine dans les s√©quences de cours
            qui suivent.
          </p>

          <p>
            Pour faire court, le principe de l&rsquo;ORM est de convertir chaque
            instance d&rsquo;une relation (chaque ligne d&rsquo;une table de la base de
            donn√©es) en instance d&rsquo;une classe PHP en m√©moire, et
            inversement. Doctrine appelle <i>Entit√©</i> ces classes d&rsquo;objets.
          </p>

          <p>
            Le programmeur peut ainsi √©crire des classes PHP utilisant les
            fonctionnalit√©s de Doctrine, et ainsi g√©rer des instances des entit√©s,
            ou des collections d&rsquo;entit√©s. Quand deux entit√©s sont li√©es (association
            1-n, par exemple), des fonctions permettent de g√©rer cette association
            &laquo;&nbsp;<i>OneToMany</i>&nbsp;&raquo; et d&rsquo;acc√©der √† la collection des entit√©s li√©es facilement.
          </p>

          <p>
            Pour nous faciliter la t√¢che, un assistant du <i>Maker bundler</i> nous
            permet d&rsquo;ajouter une entit√© au mod√®le des donn√©es de l&rsquo;application via
            une s√©rie de questions, et √©vite ainsi d&rsquo;√©crire le code PHP
            correspondant.
          </p>
        </div>
      </div>

      <div id="outline-container-orgedd312c" class="outline-3">
        <h3 id="orgedd312c">√âtape 2-a : Configuration de l&rsquo;environnement de d√©veloppement</h3>
        <div class="outline-text-3" id="text-orgedd312c">
        </div>

        <div id="outline-container-org0c1e47f" class="outline-4">
          <h4 id="org0c1e47f">Ajout des modules PHP utiles</h4>
          <div class="outline-text-4" id="text-org0c1e47f">
            <p>
              Nous aurons besoin de diff√©rents modules pour permettre √†
              l&rsquo;application de fonctionner, ou pour nous aider dans le prototypage
              de cette application :
            </p>
            <dl class="org-dl">
              <dt>Doctrine</dt>
              <dd>le composant d&rsquo;acc√®s √† la base de donn√©es via des objets PHP</dd>
              <dt>le &laquo;&nbsp;<i>Maker bundle</i>&nbsp;&raquo;</dt>
              <dd>qui va nous permettre de g√©n√©rer du code PHP plut√¥t
                que d&rsquo;avoir √† tout coder √† la main</dd>
              <dt>les &laquo;&nbsp;<i>DataFixtures</i>&nbsp;&raquo;</dt>
              <dd>qui permettent de charger automatiquement des
                donn√©es de test dans la base de donn√©es</dd>
            </dl>

            <p>
              Proc√©dez √† l&rsquo;installation avec les commandes suivantes √† l&rsquo;int√©rieur
              du r√©pertoire <code>miniallocine</code> :
            </p>
            <ul class="org-ul">
              <li>
                <p>
                  Doctrine :
                </p>
                <div class="org-src-container">
                  <pre class="src src-sh">composer require symfony/orm-pack
</pre>
                </div>
              </li>

              <li>
                <p>
                  &laquo;&nbsp;Maker bundle&nbsp;&raquo; :
                </p>
                <div class="org-src-container">
                  <pre class="src src-sh">composer require --dev symfony/maker-bundle
</pre>
                </div>
              </li>

              <li>
                <p>
                  DataFixtures :
                </p>

                <div class="org-src-container">
                  <pre class="src src-sh">composer require --dev doctrine/doctrine-fixtures-bundle
</pre>
                </div>
              </li>
            </ul>
          </div>
        </div>

        <div id="outline-container-org4c7371b" class="outline-4">
          <h4 id="org4c7371b"><span class="todo TODO">TODO</span> Chargement dans l&rsquo;IDE Eclipse</h4>
          <div class="outline-text-4" id="text-org4c7371b">
            <ol class="org-ol">
              <li>
                <p>
                  Dans un (autre) terminal, invoquez la commande pour lancer Eclipse pour PHP et Symfony :
                </p>

                <div class="org-src-container">
                  <pre class="src src-sh">/opt/eclipse/CSC4101/php-2019-06/eclipse/eclipse
</pre>
                </div>
              </li>

              <li>
                <p>
                  Dans le dialogue &laquo;&nbsp;<i>Select a directory as workspace</i>&nbsp;&raquo;, choisissez de
                  charger un autre Workspace que celui par d√©faut (<i>Browse</i>), et cr√©ez
                  un nouveau r√©pertoire dans <code>~/CSC4101/</code> appel√© <code>workspace</code>, par exemple.
                </p>

                <p>
                  Une fois s√©lectionn√©, le chemin du champ <i>Workspace</i> pointe sur ce
                  nouveau chemin <code>/..../CSC4101/workspace</code>.
                </p>
              </li>

              <li>Cliquez sur <i>Launch</i>. Eclipse 2019-06 se lance. Fermez la sous-fen√™tre d&rsquo;accueil
                &laquo;&nbsp;<i>Welcome</i>&nbsp;&raquo;</li>

              <li>Dans le <i>Project explorer</i>, s√©lectionnez <i>Import projects&#x2026;</i> et
                d√©pliez le contenu de l&rsquo;arbre sous &laquo;&nbsp;PHP&nbsp;&raquo;.</li>

              <li>Choisissez <i>Symfony project</i>, puis <i>Next</i></li>

              <li>
                <p>
                  Cliquez sur <i>Browse</i> en face de <i>Source folder</i>, et s√©lectionnez le
                  r√©pertoire correspondant √† votre <code>~/CSC4101/tp-01/miniallocine</code> dans
                  le s√©lecteur de fichiers. Validez.
                </p>

                <p>
                  Le dialogue d√©tecte les param√®tres du projet :
                </p>

                <ul class="org-ul">
                  <li><i>Project name</i> : <code>miniallocine</code></li>

                  <li>Source folder : <code>/.../CSC4101/tp-01/miniallocine</code></li>

                  <li><i>Dumped container</i> : &#x2026;</li>

                  <li>Symfony console : <code>bin/console</code></li>
                </ul>

                <p>
                  Cliquez sur <i>Finish</i>
                </p>
              </li>
            </ol>

            <p>
              Le projet se charge et Eclipse indexe le contenu des sources PHP.
            </p>

            <p>
              Si vous allez dans le menu <i>Project &gt; Properties</i> puis dans la section
              &laquo;&nbsp;<i>Project natures</i>&nbsp;&raquo;, la liste doit contenir les entr√©es
              &laquo;&nbsp;<i>Symfony Project
                Nature</i>&nbsp;&raquo; et &laquo;&nbsp;<i>Doctrine Project Nature</i>&nbsp;&raquo;. S&rsquo;il manque
              &laquo;&nbsp;Doctrine&nbsp;&raquo;,
              ajoutez-la avec le bouton &laquo;&nbsp;Add&nbsp;&raquo;<sup><a id="fnr.4" class="footref"
                  href="#fn.4">4</a></sup>.
            </p>
          </div>
        </div>


        <div id="outline-container-orgffef1e9" class="outline-4">
          <h4 id="orgffef1e9">Configuration du projet pour les tests</h4>
          <div class="outline-text-4" id="text-orgffef1e9">
            <p>
              Il est maintenant n√©cessaire de configurer des √©l√©ments de
              l&rsquo;environnement de tests de l&rsquo;application.
            </p>

            <p>
              Modifiez le fichier (cach√©) <code>.env</code> pr√©sent √† la racine du projet, qui d√©finit
              des variables d&rsquo;environnement, comme les param√®tres d&rsquo;acc√®s √† la base
              de donn√©es.
            </p>

            <p>
              Dans l&rsquo;environnement de d√©veloppement et mise au point, vous utilisez
              SQLite.
            </p>

            <ol class="org-ol">
              <li>Ouvrez le fichier dans Eclipse : menu &laquo;&nbsp;<i>File &gt; Open file</i>&nbsp;&raquo;, puis
                naviguez dans le r√©pertoire racine du projet
                (<code>~/CSC4101/tp-01/miniallocine</code>) et affichez les fichiers cach√©s
                (menu bouton droit puis cocher &laquo;&nbsp;Afficher les fichiers cach√©s&nbsp;&raquo;)</li>
              <li>S√©lectionnez le fichier <code>.env</code></li>
              <li>
                <p>
                  Modifiez la valeur de la variable <code>DATABASE_URL</code>
                  pour prendre la valeur :
                </p>
                <pre class="example">
DATABASE_URL=sqlite:///%kernel.project_dir%/var/data.db
</pre>
              </li>
            </ol>

            <p>
              Ainsi, la base de donn√©es SQLite sera cr√©√©e ult√©rieurement dans
              <code>~/CSC4101/tp-01/miniallocine/var/data.db</code>.
            </p>
          </div>
        </div>
      </div>

      <div id="outline-container-org7d9c2a4" class="outline-3">
        <h3 id="org7d9c2a4">√âtape 2-b : Ajout entit√© &laquo;&nbsp;Film&nbsp;&raquo;</h3>
        <div class="outline-text-3" id="text-org7d9c2a4">
          <div class="objectif">
            <p>
              On va attaquer la r√©alisation de l&rsquo;application par l&rsquo;ajout de la
              couche d&rsquo;acc√®s aux donn√©es, de persistence, dans le mod√®le en 3
              couches (3 tiers) qu&rsquo;on a vu en cours.
            </p>

          </div>

          <p>
            Commen√ßons par l&rsquo;ajout de l&rsquo;entit√© <code>Film</code> ayant deux attributs <code>title</code>
            (titre du film) et <code>year</code> (ann√©e de sortie).
          </p>

          <div class="attention">
            <p>
              Si vous √™tes comme la plupart des programmeurs, vous aimez mod√©r√©ment
              copier-coller du code qui pourrait √™tre g√©n√©r√© automatiquement.<br>
              <br>
              √áa tombe bien, Symfony propose diff√©rent assistants qu&rsquo;on ne va pas se
              priver d&rsquo;utiliser pour g√©n√©rer la base du code de nos applications,
              plut√¥t que d&rsquo;√©crire nous-m√™me du code bugg√©.
            </p>

          </div>


          <p>
            Lancez l&rsquo;assistant <code>make:entity</code>, dans le terminal, depuis l&rsquo;int√©rieur
            du projet Symfony. Il va nous servir √† g√©n√©rer le code de classes PHP
            pour g√©rer notre entit√© &laquo;&nbsp;Film&nbsp;&raquo;.
          </p>

          <p>
            R√©pondez aux questions de l&rsquo;assistant pour obtenir une interaction similaire √†
            la trace pr√©sent√©e ci-dessous :
          </p>

          <div class="org-src-container">
            <pre class="src src-sh">php bin/console make:entity
</pre>
          </div>

          <pre class="example">
 Class name of the entity to create or update (e.g. TinyElephant):
 &gt; Film

 created: src/Entity/Film.php
 created: src/Repository/FilmRepository.php
 
 Entity generated! Now let's add some fields!
 You can always add more fields later manually or by re-running this command.

 New property name (press &lt;return&gt; to stop adding fields):
 &gt; title

 Field type (enter ? to see all types) [string]:
 &gt; string

 Field length [255]:
 &gt; 

 Can this field be null in the database (nullable) (yes/no) [no]:
 &gt; 

 updated: src/Entity/Film.php

 Add another property? Enter the property name (or press &lt;return&gt; to stop adding fields):
 &gt; year

 Field type (enter ? to see all types) [string]:
 &gt; ?

Main types
  * string
  * text
  * boolean
  * integer (or smallint, bigint)
  * float

Relationships / Associations
  * relation (a wizard üßô will help you build the relation)
  * ManyToOne
  * OneToMany
  * ManyToMany
  * OneToOne

Array/Object Types
  * array (or simple_array)
  * json
  * object
  * binary
  * blob

Date/Time Types
  * datetime (or datetime_immutable)
  * datetimetz (or datetimetz_immutable)
  * date (or date_immutable)
  * time (or time_immutable)
  * dateinterval

Other Types
  * json_array
  * decimal
  * guid


 Field type (enter ? to see all types) [string]:
 &gt; integer

 Can this field be null in the database (nullable) (yes/no) [no]:
 &gt; 

 updated: src/Entity/Film.php

 Add another property? Enter the property name (or press &lt;return&gt; to stop adding fields):
 &gt; 


           
  Success! 
           

 Next: When you're ready, create a migration with make:migration
</pre>

          <p>
            L&rsquo;assistant a cr√©√© pour nous deux classes PHP qui utilisent Doctrine :
          </p>
          <ul class="org-ul">
            <li><code>src/Entity/Film.php</code> : g√®re les instances en m√©moire des films</li>
            <li><code>src/Repository/FilmRepository.php</code> : g√®re le chargement des films
              depuis la base de donn√©e</li>
          </ul>

          <p>
            Rafra√Æchissez votre projet dans Eclipse si n√©cessaire pour voir appara√Ætre ces
            deux classes.
          </p>
        </div>
      </div>

      <div id="outline-container-org23c69ca" class="outline-3">
        <h3 id="org23c69ca">√âtape 2-c : Ajout entit√© Recommendation</h3>
        <div class="outline-text-3" id="text-org23c69ca">
          <p>
            De fa√ßon similaire, ajoutez une entit√© <code>Recommendation</code>, qui ne
            comporte qu&rsquo;un attribut <code>recommendation</code> pour le moment.
          </p>

          <p>
            L&rsquo;assistant va nous permettre de d√©clarer qu&rsquo;on souhaite ajouter une
            association avec l&rsquo;entit√© <code>Film</code>, mat√©rialis√©e par l&rsquo;attribut
            <code>Recommendation::film</code>, de type <code>relation</code> et de cardinalit√©
            <code>ManyToOne</code>, qui sera une r√©f√©rence au film sur lequel porte la
            recommendation (plusieurs recommendations portent sur le m√™me film).
          </p>

          <div class="org-src-container">
            <pre class="src src-sh">php bin/console make:entity
</pre>
          </div>
          <pre class="example">
 Class name of the entity to create or update (e.g. BraveKangaroo):
 &gt; Recommendation

 created: src/Entity/Recommendation.php
 created: src/Repository/RecommendationRepository.php
 
 Entity generated! Now let's add some fields!
 You can always add more fields later manually or by re-running this command.

 New property name (press &lt;return&gt; to stop adding fields):
 &gt; recommendation

 Field type (enter ? to see all types) [string]:
 &gt; 

 Field length [255]:
 &gt; 	

 Can this field be null in the database (nullable) (yes/no) [no]:
 &gt; 

 updated: src/Entity/Recommendation.php

 Add another property? Enter the property name (or press &lt;return&gt; to stop adding fields):
 &gt; film

 Field type (enter ? to see all types) [string]:
 &gt; ?

Main types
  * string
  * text
  * boolean
  * integer (or smallint, bigint)
  * float

Relationships / Associations
  * relation (a wizard üßô will help you build the relation)
  * ManyToOne
  * OneToMany
  * ManyToMany
  * OneToOne

Array/Object Types
  * array (or simple_array)
  * json
  * object
  * binary
  * blob

Date/Time Types
  * datetime (or datetime_immutable)
  * datetimetz (or datetimetz_immutable)
  * date (or date_immutable)
  * time (or time_immutable)
  * dateinterval

Other Types
  * json_array
  * decimal
  * guid


 Field type (enter ? to see all types) [string]:
 &gt; relation

 What class should this entity be related to?:
 &gt; Film

What type of relationship is this?
 ------------ -------------------------------------------------------------------------- 
  Type         Description                                                               
 ------------ -------------------------------------------------------------------------- 
  ManyToOne    Each Recommendation relates to (has) one Film.                            
               Each Film can relate to (can have) many Recommendation objects            
                                                                                         
  OneToMany    Each Recommendation can relate to (can have) many Film objects.           
               Each Film relates to (has) one Recommendation                             
                                                                                         
  ManyToMany   Each Recommendation can relate to (can have) many Film objects.           
               Each Film can also relate to (can also have) many Recommendation objects  
                                                                                         
  OneToOne     Each Recommendation relates to (has) exactly one Film.                    
               Each Film also relates to (has) exactly one Recommendation.               
 ------------ -------------------------------------------------------------------------- 

 Relation type? [ManyToOne, OneToMany, ManyToMany, OneToOne]:
 &gt; ManyToOne

 Is the Recommendation.film property allowed to be null (nullable)? (yes/no) [yes]:
 &gt; no	

 Do you want to add a new property to Film so that you can access/update Recommendation objects from it - e.g. $film-&gt;getRecommendations()? (yes/no) [yes]:
 &gt; 

 A new property will also be added to the Film class so that you can access the related Recommendation objects from it.

 New field name inside Film [recommendations]:
 &gt; 

 Do you want to activate orphanRemoval on your relationship?
 A Recommendation is "orphaned" when it is removed from its related Film.
 e.g. $film-&gt;removeRecommendation($recommendation)
 
 NOTE: If a Recommendation may *change* from one Film to another, answer "no".

 Do you want to automatically delete orphaned App\Entity\Recommendation objects (orphanRemoval)? (yes/no) [no]:
 &gt; yes

 updated: src/Entity/Recommendation.php
 updated: src/Entity/Film.php

 Add another property? Enter the property name (or press &lt;return&gt; to stop adding fields):
 &gt; 


           
  Success! 
           

 Next: When you're ready, create a migration with make:migration
</pre>

          <p>
            La d√©claration du param√®tre <code>orphanRemoval</code> permet de g√©rer le fait
            qu&rsquo;un film est une entit√© ma√Ætre dans la relation, et que les
            relations sans film n&rsquo;ont pas lieu d&rsquo;exister (on reverra cela plus tard).
          </p>

          <p>
            Rechargez le projet pour voir appara√Ætre le code des nouvelles classes
            PHP :
          </p>
          <ul class="org-ul">
            <li><code>src/Entity/Recommendation.php</code></li>
            <li><code>src/Repository/RecommendationRepository.php</code></li>
          </ul>
          <p>
            mais aussi les modifications effectu√©es dans <code>src/Entity/Film.php</code>
          </p>
        </div>
      </div>


      <div id="outline-container-org16d203c" class="outline-3">
        <h3 id="org16d203c">√âtape 2-d : Observation du code PHP g√©n√©r√©</h3>
        <div class="outline-text-3" id="text-org16d203c">
          <p>
            Sans surprise, la classe <code>Film</code> comporte deux attributs primaires :
            <code>title</code> et <code>year</code> (et leurs <i>getters</i> et <i>setters</i>), mais aussi un
            attribut <code>id</code> n√©cessaire au <i>mapping</i> avec les entit√©s de la base de
            donn√©es (la valeur de la cl√© primaire : une annotation particuli√®re
            <code>@ORM\Id()</code> est sp√©cifi√©e).
          </p>

          <p>
            Mais elle comporte aussi un attribut multi-valu√© <code>recommendations</code> qui
            agit comme une collection des instances de <code>Recommendation</code> relatives
            √† une instance de <code>Film</code>. Elle est sp√©cifi√©e par l&rsquo;annotation
            <code>@ORM\OneToMany</code> qui d√©finit en particulier l&rsquo;entit√© cible de
            l&rsquo;association 1-n (<code>targetEntity</code>&laquo;&nbsp;App\Entity\Recommendation&nbsp;&raquo;<code>).
Elle se manipule en PHP avec une interface =Collection</code> semblable aux
            tableaux PHP classiques (<code>Array</code>).
          </p>

          <p>
            Plut√¥t que des <i>getters</i> et <i>setters</i>, <code>recommendations</code> dispose donc
            des m√©thodes <code>getRecommendations(): Collection</code>,
            <code>addRecommendation(Recommendation $recommendation)</code> et
            <code>removeRecommendation(Recommendation $recommendation)</code>.
          </p>

          <p>
            Exemple de boucle √©num√©rant les recommendations d&rsquo;un film :
          </p>
          <div class="org-src-container">
            <pre class="src src-php"><span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">recommendations</span> = <span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">film</span><span style="color: #000000; background-color: #ffffff;">-&gt;</span><span style="color: #000000; background-color: #ffffff;">getRecommendations</span>();

<span style="color: #a020f0;">if</span> (count(<span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">recommendations</span>))
{
    <span style="color: #a020f0;">foreach</span>(<span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">recommendations</span> <span style="color: #a020f0;">as</span> <span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">recommendation</span>)
    {
    <span style="color: #a020f0;">print</span> <span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">recommendation</span>;
    }
}

</pre>
          </div>


          <div class="remarque">
            <p>
              Il se peut que vous constatiez des erreurs ou warnings, ou des
              comportements √©tranges dans Eclipse, qui peuvent s&rsquo;expliquer dans la
              mesure o√π les g√©n√©rateurs de code travaillent &laquo;&nbsp;dans son dos&nbsp;&raquo;. Dans ce
              genre de cas, n&rsquo;h√©sitez pas √† s√©lectionner le menu &laquo;&nbsp;Project &gt; Clean&nbsp;&raquo;,
              qui aide parfois √† r√©soudre ce genre de comportements erratiques.
            </p>

          </div>
        </div>
      </div>

      <div id="outline-container-org0e2b778" class="outline-3">
        <h3 id="org0e2b778">√âtape 2-e : Cr√©ation de la base de donn√©es</h3>
        <div class="outline-text-3" id="text-org0e2b778">
          <p>
            Proc√©dez maintenant √† la cr√©ation du fichier de stockage de la base de
            donn√©es SQLite :
          </p>
          <div class="org-src-container">
            <pre class="src src-sh">php bin/console doctrine:database:drop --force
php bin/console doctrine:database:create
</pre>
          </div>

          <p>
            Cr√©ez maintenant le sch√©ma de la base de donn√©es :
          </p>
          <div class="org-src-container">
            <pre class="src src-sh">php bin/console doctrine:schema:create
</pre>
          </div>

          <p>
            Les tables et index correspondant aux classes de notre mod√®le de
            donn√©es sont cr√©√©es. Les tables restent vides en attendant qu&rsquo;on y
            ajoute des donn√©es.
          </p>
        </div>
      </div>

      <div id="outline-container-org88c9be3" class="outline-3">
        <h3 id="org88c9be3">√âtape 2-f : Ajout du chargement de donn√©es de test</h3>
        <div class="outline-text-3" id="text-org88c9be3">
          <p>
            Le module <i>DataFixtures</i> de Symfony permet d&rsquo;utiliser un outil de
            chargement de donn√©es de test, qui permettent aux d√©veloppeurs de
            tester le code de leur mod√®le de donn√©es, en chargeant des donn√©es
            dans la base.
          </p>

          <p>
            On va l&rsquo;utiliser pour peupler la base de donn√©es avec des donn√©es de
            films ou de recommendations (qui vous rappelleront quelques souvenirs).
          </p>

          <p>
            Nous allons compl√©ter le code de la classe qui a √©t√© g√©n√©r√©e lorsqu&rsquo;on
            avait ajout√© le module DataFixtures avec Composer, au tout d√©but de la
            s√©ance. <code>persist()</code> et <code>flush()</code> sont des m√©thodes du gestionnaire de
            donn√©es Doctrine qu&rsquo;on √©tudiera plus tard, et qui ont pour effet de
            sauvegarder dans la base les donn√©es pr√©sentes en m√©moire.
          </p>

          <p>
            Copiez-collez le code ci-dessous de fa√ßon √† remplacer le contenu du
            fichier source
            <code>src/DataFixtures/AppFixtures.php</code>.
          </p>

          <p>
            Les commentaires dans le source devraient vous permettre de facilement
            identifier la nature des donn√©es charg√©es dans la base, m√™me si on
            utilise des m√©canismes pas forc√©ment limpides aujourd&rsquo;hui (g√©n√©rateurs
            avec <code>yield</code>).
          </p>

          <p>
            Le c≈ìur de l&rsquo;op√©ration se passe dans les appels aux <i>setters</i> des
            attributs des instances (cr√©es avec <code>new</code>) des classes <code>Film</code> ou
            <code>Recommendation</code>, de fa√ßon similaire √† ce qu&rsquo;on fait en Java.
          </p>

          <div class="org-src-container">
            <pre class="src src-php"><span style="color: #483d8b;">&lt;?php</span>

<span style="color: #a020f0;">namespace</span> <span style="color: #228b22;">App\DataFixtures</span>;

<span style="color: #a020f0;">use</span> <span style="color: #228b22;">App\Entity\Film</span>;
<span style="color: #a020f0;">use</span> <span style="color: #228b22;">App\Repository\FilmRepository</span>;
<span style="color: #a020f0;">use</span> <span style="color: #228b22;">Doctrine\Bundle\FixturesBundle\Fixture</span>;
<span style="color: #a020f0;">use</span> <span style="color: #228b22;">Doctrine\Persistence\ObjectManager</span>;
<span style="color: #a020f0;">use</span> <span style="color: #228b22;">App\Entity\Recommendation</span>;

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">AppFixtures</span> <span style="color: #a020f0;">extends</span> <span style="color: #228b22;">Fixture</span>
{
    <span style="color: #8b2252;">/**</span>
<span style="color: #8b2252;">     * Generates initialization data for films : [title, year]</span>
<span style="color: #8b2252;">     * </span><span style="color: #008b8b;">@return</span><span style="color: #8b2252;"> \\Generator</span>
<span style="color: #8b2252;">     */</span>
    <span style="color: #a020f0;">private</span> <span style="color: #a020f0;">static</span> <span style="color: #a020f0;">function</span> <span style="color: #0000ff;">filmsDataGenerator</span>()
    {
    <span style="color: #a020f0;">yield</span> [<span style="color: #8b2252;">"Evil Dead"</span>, 1981];
    <span style="color: #a020f0;">yield</span> [<span style="color: #8b2252;">"Evil Dead"</span>, 2013];
    <span style="color: #a020f0;">yield</span> [<span style="color: #8b2252;">"Fanfan la Tulipe"</span>, 2003];
    <span style="color: #a020f0;">yield</span> [<span style="color: #8b2252;">"Fanfan la Tulipe"</span>, 1952];
    <span style="color: #a020f0;">yield</span> [<span style="color: #8b2252;">"Mary a tout prix"</span>, 1998];
    <span style="color: #a020f0;">yield</span> [<span style="color: #8b2252;">"Black Sheep"</span>, 2008];
    <span style="color: #a020f0;">yield</span> [<span style="color: #8b2252;">"Le Monde de Nemo"</span>, 2003];
    }

    <span style="color: #8b2252;">/**</span>
<span style="color: #8b2252;">     * Generates initialization data for film recommendations:</span>
<span style="color: #8b2252;">     *  [film_title, film_year, recommendation]</span>
<span style="color: #8b2252;">     * </span><span style="color: #008b8b;">@return</span><span style="color: #8b2252;"> \\Generator</span>
<span style="color: #8b2252;">     */</span>
    <span style="color: #a020f0;">private</span> <span style="color: #a020f0;">static</span> <span style="color: #a020f0;">function</span> <span style="color: #0000ff;">filmRecommendationsGenerator</span>()
    {
    <span style="color: #a020f0;">yield</span> [<span style="color: #8b2252;">"Evil Dead"</span>, 1981, <span style="color: #8b2252;">"Ouh ! Mais &#231;a fait peur !"</span>];
    <span style="color: #a020f0;">yield</span> [<span style="color: #8b2252;">"Evil Dead"</span>, 2013, <span style="color: #8b2252;">"M&#234;me pas peur !"</span>];
    <span style="color: #a020f0;">yield</span> [<span style="color: #8b2252;">"Evil Dead"</span>, 2013, <span style="color: #8b2252;">"Insipide et sans saveur"</span>];
    <span style="color: #a020f0;">yield</span> [<span style="color: #8b2252;">"Fanfan la Tulipe"</span>, 1952, <span style="color: #8b2252;">"Manque de couleurs"</span>];
    <span style="color: #a020f0;">yield</span> [<span style="color: #8b2252;">"Fanfan la Tulipe"</span>, 1952, <span style="color: #8b2252;">"Super sc&#232;nes de combat"</span>];
    <span style="color: #a020f0;">yield</span> [<span style="color: #8b2252;">"Fanfan la Tulipe"</span>, 2003, <span style="color: #8b2252;">"Mais pourquoi ???"</span>];
    <span style="color: #a020f0;">yield</span> [<span style="color: #8b2252;">"Mary a tout prix"</span>, 1998, <span style="color: #8b2252;">"Le meilleur film de tous les temps"</span>];
    <span style="color: #a020f0;">yield</span> [<span style="color: #8b2252;">"Black Sheep"</span>, 2008, <span style="color: #8b2252;">"Un scenario de g&#233;nie"</span>];
    <span style="color: #a020f0;">yield</span> [<span style="color: #8b2252;">"Black Sheep"</span>, 2008, <span style="color: #8b2252;">"Une r&#233;alisation parfaite"</span>];
    <span style="color: #a020f0;">yield</span> [<span style="color: #8b2252;">"Black Sheep"</span>, 2008, <span style="color: #8b2252;">"&#192; quand Black Goat ?"</span>];  
    }

    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">function</span> <span style="color: #0000ff;">load</span>(<span style="color: #228b22;">ObjectManager</span> <span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">manager</span>)
    {
    <span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">filmRepo</span> = <span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">manager</span><span style="color: #000000; background-color: #ffffff;">-&gt;</span><span style="color: #000000; background-color: #ffffff;">getRepository</span>(<span style="color: #008b8b;">Film</span><span style="color: #000000; background-color: #ffffff;">::</span><span style="color: #483d8b;">class</span>);

    <span style="color: #a020f0;">foreach</span> (<span style="color: #a020f0;">self</span><span style="color: #000000; background-color: #ffffff;">::</span><span style="color: #000000; background-color: #ffffff;">filmsDataGenerator</span>() <span style="color: #a020f0;">as</span> [<span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">title</span>, <span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">year</span>] ) {
        <span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">film</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Film</span>();
        <span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">film</span><span style="color: #000000; background-color: #ffffff;">-&gt;</span><span style="color: #000000; background-color: #ffffff;">setTitle</span>(<span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">title</span>);
        <span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">film</span><span style="color: #000000; background-color: #ffffff;">-&gt;</span><span style="color: #000000; background-color: #ffffff;">setYear</span>(<span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">year</span>);
        <span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">manager</span><span style="color: #000000; background-color: #ffffff;">-&gt;</span><span style="color: #000000; background-color: #ffffff;">persist</span>(<span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">film</span>);           
    }
    <span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">manager</span><span style="color: #000000; background-color: #ffffff;">-&gt;</span><span style="color: #000000; background-color: #ffffff;">flush</span>();

    <span style="color: #a020f0;">foreach</span> (<span style="color: #a020f0;">self</span><span style="color: #000000; background-color: #ffffff;">::</span><span style="color: #000000; background-color: #ffffff;">filmRecommendationsGenerator</span>() <span style="color: #a020f0;">as</span> [<span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">title</span>, <span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">year</span>, <span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">recommendation</span>])
    {
        <span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">film</span> = <span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">filmRepo</span><span style="color: #000000; background-color: #ffffff;">-&gt;</span><span style="color: #000000; background-color: #ffffff;">findOneBy</span>([<span style="color: #8b2252;">'title'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">title</span>, <span style="color: #8b2252;">'year'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">year</span>]);
        <span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">reco</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Recommendation</span>();
        <span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">reco</span><span style="color: #000000; background-color: #ffffff;">-&gt;</span><span style="color: #000000; background-color: #ffffff;">setRecommendation</span>(<span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">recommendation</span>);
        <span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">film</span><span style="color: #000000; background-color: #ffffff;">-&gt;</span><span style="color: #000000; background-color: #ffffff;">addRecommendation</span>(<span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">reco</span>);
        <span style="color: #b22222;">// </span><span style="color: #b22222;">there's a cascade persist on fim-recommendations which avoids persisting down the relation</span>
        <span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">manager</span><span style="color: #000000; background-color: #ffffff;">-&gt;</span><span style="color: #000000; background-color: #ffffff;">persist</span>(<span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">film</span>);
    }
    <span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">manager</span><span style="color: #000000; background-color: #ffffff;">-&gt;</span><span style="color: #000000; background-color: #ffffff;">flush</span>();
    }
}

</pre>
          </div>

          <p>
            Sauvegardez cette modification, et testez l&rsquo;ex√©cution du chargement
            des donn√©es de test :
          </p>

          <div class="org-src-container">
            <pre class="src src-sh">php bin/console doctrine:fixtures:load -n
</pre>
          </div>

          <p>
            La commande affiche des erreurs du type :
          </p>

          <pre class="example">
In ORMInvalidArgumentException.php line 105:
                                                                                                                                                                                                          
  Multiple non-persisted new entities were found through the given association graph:                                                                                                                     
                                                                                                                                                                                                          
   * A new entity was found through the relationship 'App\Entity\Film#recommendations' that was not configured to cascade persist operations for entity: App\Entity\Recommendation@000000003e5fd2a800000  
  0003284ac56. To solve this issue: Either explicitly call EntityManager#persist() on this unknown entity or configure cascade persist this association in the mapping for example @ManyToOne(..,cascade  
  ={"persist"}). If you cannot find out which entity causes the problem implement 'App\Entity\Recommendation#__toString()' to get a clue.
</pre>

          <p>
            Le probl√®me qui se pose est que le code g√©n√©r√© par l&rsquo;assistant pour
            l&rsquo;association 1-N qui lie les entit√©s Film et Recommendation n&rsquo;a pas
            pu prendre toutes les d√©cisions n√©cessaires. Si vous lisez
            attentivement le message d&rsquo;erreur ci-dessus, Symfony nous donne quand
            m√™me des recommendations utileS.
          </p>

          <p>
            On va corriger ce probl√®me dans l&rsquo;√©tape suivante.
          </p>

          <p>
            Les assistants g√©n√©rateur de code nous facilitent beaucoup le travail,
            mais ils ne font quand m√™me pas tout √† notre place.
          </p>

          <p>
            Ne vous inqui√©tez pas, nous reverrons en d√©tail tous ces √©l√©ments
            dans les s√©quences suivantes du cours, mais pour l&rsquo;instant, suivez le
            pr√©sent support : on n&rsquo;est plus tr√®s loin du but !
          </p>
        </div>
      </div>

      <div id="outline-container-orgd6aa279" class="outline-3">
        <h3 id="orgd6aa279">√âtape 2-g : Ajout de la persistence en <i>cascade</i></h3>
        <div class="outline-text-3" id="text-orgd6aa279">
          <p>
            Appliquons la suggestion donn√©e par le message d&rsquo;erreur ci-dessus.
          </p>

          <p>
            Ajoutez <code>cascade={"persist"}</code> dans les options de l&rsquo;annotation
            <code>@ORM\OneToMany</code> de <code>Film::recommendations</code>, dans le fichier source
            <code>src/Entity/Film.php</code> :
          </p>

          <div class="org-src-container">
            <pre class="src src-php"><span style="color: #8b2252;">/**</span>
<span style="color: #8b2252;"> * </span><span style="color: #008b8b;">@ORM\OneToMany</span><span style="color: #8b2252;">(targetEntity="App\Entity\Recommendation", mappedBy="film", orphanRemoval=true, cascade={"persist"})</span>
<span style="color: #8b2252;"> */</span>
<span style="color: #a020f0;">private</span> <span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">recommendations</span>;
</pre>
          </div>

          <p>
            Relancez le chargement des donn√©es de test, qui va marcher, cette fois :
          </p>
          <pre class="example">
php bin/console doctrine:fixtures:load -n

   &gt; purging database
   &gt; loading App\DataFixtures\AppFixtures

</pre>
        </div>
      </div>
      <div id="outline-container-org539172d" class="outline-3">
        <h3 id="org539172d">√âtape 2-h : V√©rification du contenu de la base de donn√©es</h3>
        <div class="outline-text-3" id="text-org539172d">
          <p>
            Il n&rsquo;y a plus qu&rsquo;√† v√©rifier le contenu de la base de donn√©es SQLite
            pr√©sente dans notre projet (dans <code>var/data.db</code>), avec un peu de SQL :
          </p>

          <div class="org-src-container">
            <pre class="src src-sh">php bin/console doctrine:query:sql <span style="color: #8b2252;">'SELECT * FROM film'</span>
</pre>
          </div>

          <p>
            Idem pour la table <code>recommendation</code> :
          </p>
          <div class="org-src-container">
            <pre class="src src-sh">php bin/console doctrine:query:sql <span style="color: #8b2252;">'SELECT * FROM recommendation where film_id=2'</span>
</pre>
          </div>

          <p>
            Et voil√†, la couche d&rsquo;acc√®s aux donn√©es fonctionne. Ajoutons
            maintenant la pr√©sentation.
          </p>
        </div>
      </div>
    </div>

    <div id="outline-container-org3481d98" class="outline-2">
      <h2 id="org3481d98">√âtape 3 : Ajout interface console</h2>
      <div class="outline-text-2" id="text-org3481d98">
        <div class="objectif">
          <p>
            Cette √©tape va permettre d&rsquo;ajouter une couche de pr√©sentation dans
            notre application.
          </p>

        </div>

        <p>
          Pour l&rsquo;instant on va reproduire √† peu pr√®s ce qui existait dans
          l&rsquo;application en Java √©tudi√©e l&rsquo;ann√©e pass√©e, avec une pr√©sentation
          pour l&rsquo;interaction en ligne de commande dans un terminal.
        </p>
      </div>

      <div id="outline-container-orga3db0cb" class="outline-3">
        <h3 id="orga3db0cb">√âtape 3-a : Ajout de la commande <code>app:list-films</code></h3>
        <div class="outline-text-3" id="text-orga3db0cb">
          <div class="objectif">
            <p>
              Ajoutons une interface en ligne de commande √† notre application PHP,
              pour disposer d&rsquo;une commande accessible pour l&rsquo;utilisateur via
              l&rsquo;interface principale offerte par <code>bin/console</code>.
            </p>

          </div>

          <p>
            Cette fois encore, utilisons un assistant g√©n√©rateur de code pour nous
            faciliter le travail :
          </p>

          <div class="org-src-container">
            <pre class="src src-sh">bin/console make:command
</pre>
          </div>

          <pre class="example">
Choose a command name (e.g. app:orange-pizza):
&gt; app:list-films

created: src/Command/ListFilmsCommand.php


 Success! 


Next: open your new command class and customize it!
Find the documentation at https://symfony.com/doc/current/console.html

</pre>

          <p>
            Consultez le r√©sultat g√©n√©r√© dans <code>src/Command/ListFilmsCommand.php</code>
          </p>

          <p>
            V√©rifiez que la commande est bien disponible via :
          </p>

          <pre class="example">
bin/console list app
</pre>

          <p>
            et :
          </p>

          <pre class="example">
bin/console app:list-films --help
</pre>

          <p>
            Et enfin qu&rsquo;elle r√©pond quand on l&rsquo;invoque :
          </p>
          <pre class="example">
bin/console app:list-films

                                                                                                                        
 [OK] You have a new command! Now make it your own! Pass --help to see your options.                                    
                                                                                                                        

</pre>
        </div>
      </div>

      <div id="outline-container-org2aa746b" class="outline-3">
        <h3 id="org2aa746b">√âtape 3-b : Branchement de l&rsquo;interface √† la base de donn√©es</h3>
        <div class="outline-text-3" id="text-org2aa746b">
          <p>
            Pour que notre commande puisse afficher la liste des films on va
            devoir r√©aliser quelques branchements utiles.
          </p>

          <p>
            Modifiez le code de <code>src/Command/ListFilmsCommand.php</code>, pour ajouter
            un attribut <code>filmRepository</code> dans la classe <code>ListFilmsCommand</code>, permettant
            de g√©rer l&rsquo;acc√®s √† la base de donn√©es via le composant Doctrine, et
            son initialisation.
          </p>

          <p>
            Copiez-collez les √©l√©ments ci-dessous sans
            dupliquer la d√©claration de la classe <code>ListFilmsCommand</code> :
          </p>

          <div class="org-src-container">
            <pre class="src src-php"><span style="color: #b22222;">// </span><span style="color: #b22222;">...</span>

<span style="color: #a020f0;">use</span> <span style="color: #228b22;">App\Entity\Film</span>;
<span style="color: #a020f0;">use</span> <span style="color: #228b22;">App\Repository\FilmRepository</span>;
<span style="color: #a020f0;">use</span> <span style="color: #228b22;">Symfony\Component\DependencyInjection\ContainerInterface</span>;

<span style="color: #b22222;">// </span><span style="color: #b22222;">...</span>

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">ListFilmsCommand</span> <span style="color: #a020f0;">extends</span> <span style="color: #228b22;">Command</span>
{
    <span style="color: #8b2252;">/**</span>
<span style="color: #8b2252;">     * </span><span style="color: #008b8b;">@var</span><span style="color: #8b2252;"> </span><span style="color: #8b2252;">FilmRepository</span>
<span style="color: #8b2252;">     */</span>
    <span style="color: #a020f0;">private</span> <span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">filmRepository</span>;

    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">function</span> <span style="color: #0000ff;">__construct</span>(<span style="color: #228b22;">ContainerInterface</span> <span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">container</span>)
    {
    <span style="color: #a020f0;">parent</span><span style="color: #000000; background-color: #ffffff;">::</span><span style="color: #000000; background-color: #ffffff;">__construct</span>();
    <span style="color: #008b8b;">$</span><span style="color: #008b8b;">this</span><span style="color: #000000; background-color: #ffffff;">-&gt;</span><span style="color: #a0522d;">filmRepository</span> = <span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">container</span><span style="color: #000000; background-color: #ffffff;">-&gt;</span><span style="color: #000000; background-color: #ffffff;">get</span>(<span style="color: #8b2252;">'doctrine'</span>)<span style="color: #000000; background-color: #ffffff;">-&gt;</span><span style="color: #000000; background-color: #ffffff;">getManager</span>()<span style="color: #000000; background-color: #ffffff;">-&gt;</span><span style="color: #000000; background-color: #ffffff;">getRepository</span>(<span style="color: #008b8b;">Film</span><span style="color: #000000; background-color: #ffffff;">::</span><span style="color: #483d8b;">class</span>);
    }

    <span style="color: #b22222;">//</span><span style="color: #b22222;">...</span>


</pre>
          </div>
        </div>
      </div>


      <div id="outline-container-org75dda17" class="outline-3">
        <h3 id="org75dda17">√âtape 3-c : Ajout de l&rsquo;affichage de la liste des films</h3>
        <div class="outline-text-3" id="text-org75dda17">
          <p>
            Ajoutez le code permettant de charger tous les films pr√©sents dans la
            base de donn√©es.
          </p>

          <p>
            On utilise la m√©thode <code>findAll()</code> du <i>repository</i>
            Doctrine des films <code>FilmRepository</code>, qui a √©t√© g√©n√©r√© par
            l&rsquo;asssistant, et qui renvoie un
            tableau de films. On peut manipuler ce tableau comme un tableau PHP
            ordinaire, par exemple avec <code>foreach</code>.
          </p>

          <p>
            Modifiez la m√©thode <code>execute()</code> de <code>ListFilmsCommand</code> :
          </p>

          <div class="org-src-container">
            <pre class="src src-php"><span style="color: #a020f0;">protected</span> <span style="color: #a020f0;">function</span> <span style="color: #0000ff;">execute</span>(<span style="color: #228b22;">InputInterface</span> <span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">input</span>, <span style="color: #228b22;">OutputInterface</span> <span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">output</span>)
    {
        <span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">films</span> = <span style="color: #008b8b;">$</span><span style="color: #008b8b;">this</span><span style="color: #000000; background-color: #ffffff;">-&gt;</span><span style="color: #a0522d;">filmRepository</span><span style="color: #000000; background-color: #ffffff;">-&gt;</span><span style="color: #000000; background-color: #ffffff;">findAll</span>();
        <span style="color: #a020f0;">if</span>(!<span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">films</span>) {
        <span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">output</span><span style="color: #000000; background-color: #ffffff;">-&gt;</span><span style="color: #000000; background-color: #ffffff;">writeln</span>(<span style="color: #8b2252;">'&lt;comment&gt;no films found&lt;comment&gt;'</span>);
        <span style="color: #a020f0;">exit</span>(1);
        }

        <span style="color: #a020f0;">foreach</span>(<span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">films</span> <span style="color: #a020f0;">as</span> <span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">film</span>)
        {
        <span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">output</span><span style="color: #000000; background-color: #ffffff;">-&gt;</span><span style="color: #000000; background-color: #ffffff;">writeln</span>(<span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">film</span>);
        }

    }
</pre>
          </div>

          <p>
            Testez avec :
          </p>
          <pre class="example">
bin/console app:list-films
</pre>

          <p>
            Le programme √©choue avec une erreur du type :
          </p>
          <pre class="example">
bin/console app:list-films

In OutputFormatter.php line 134:
                                                                                           
  Catchable Fatal Error: Object of class App\Entity\Film could not be converted to string  
                                                                                           

app:list-films [--option1] [-h|--help] [-q|--quiet] [-v|vv|vvv|--verbose] [-V|--version] [--ansi] [--no-ansi] [-n|--no-interaction] [-e|--env ENV] [--no-debug] [--] &lt;command&gt; [&lt;arg1&gt;]

</pre>

          <p>
            Ce genre de chose devrait vous para√Ætre coh√©rent avec ce qui a √©t√© vu
            l&rsquo;ann√©e pass√©e en programmation orient√©e objet.
          </p>

          <p>
            La m√©thode <code>writeln()</code> essaie d&rsquo;afficher une cha√Æne de caract√®res sur
            la console&#x2026; mais une instance de la classe <code>Film</code> peut-elle √™tre
            convertie en cha√Æne de caract√®res ? Pas de base, en PHP.
          </p>
        </div>
      </div>

      <div id="outline-container-org606d89a" class="outline-3">
        <h3 id="org606d89a">√âtape 3-d : Ajout de Film::__toString()</h3>
        <div class="outline-text-3" id="text-org606d89a">
          <p>
            Ajoutez la m√©thode de conversion de film en cha√Æne de caract√®re qui
            nous manque : <code>Film::__toString()</code>, par exemple :
          </p>
          <div class="org-src-container">
            <pre class="src src-php">
<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">function</span> <span style="color: #0000ff;">__toString</span>() {
    <span style="color: #a020f0;">return</span> <span style="color: #008b8b;">$</span><span style="color: #008b8b;">this</span><span style="color: #000000; background-color: #ffffff;">-&gt;</span><span style="color: #a0522d;">title</span> . <span style="color: #8b2252;">" ("</span> . <span style="color: #008b8b;">$</span><span style="color: #008b8b;">this</span><span style="color: #000000; background-color: #ffffff;">-&gt;</span><span style="color: #a0522d;">year</span> . <span style="color: #8b2252;">")"</span>;
}

</pre>
          </div>

          <p>
            R√©essayez le lancement de notre application :
          </p>

          <pre class="example">
bin/console app:list-films
Evil Dead (1981)
Evil Dead (2013)
Fanfan la Tulipe (2003)
Fanfan la Tulipe (1952)
Mary a tout prix (1998)
Black Sheep (2008)
Le Monde de Nemo (2003)

</pre>

          <p>
            Essayez l&rsquo;option <code>-vvv</code> :
          </p>
          <pre class="example">
bin/console app:list-films -vvv
2019-07-22T15:24:52+02:00 [debug] Notified event "console.command" to listener "Symfony\Component\HttpKernel\EventListener\DebugHandlersListener::configure".
2019-07-22T15:24:52+02:00 [debug] SELECT t0.id AS id_1, t0.title AS title_2, t0.year AS year_3 FROM film t0
Evil Dead (1981)
Evil Dead (2013)
Fanfan la Tulipe (2003)
Fanfan la Tulipe (1952)
Mary a tout prix (1998)
Black Sheep (2008)
Le Monde de Nemo (2003)
2019-07-22T15:24:52+02:00 [debug] Notified event "console.terminate" to listener "Symfony\Bundle\MakerBundle\Event\ConsoleErrorSubscriber::onConsoleTerminate".
2019-07-22T15:24:52+02:00 [debug] Notified event "console.terminate" to listener "Symfony\Component\Console\EventListener\ErrorListener::onConsoleTerminate".
</pre>

          <p>
            Cette option permet de v√©rifier ais√©ment les requ√™tes SQL effectu√©es
            dans la base de donn√©es par Doctrine. Utile en cas de bugs !
          </p>
        </div>
      </div>
    </div>

    <div id="outline-container-orgf7bc592" class="outline-2">
      <h2 id="orgf7bc592">√âtape 4 : Am√©lioration de notre application</h2>
      <div class="outline-text-2" id="text-orgf7bc592">
        <p>
          Si vous avez termin√© l&rsquo;√©tape pr√©c√©dente, tout va bien : vous avez
          r√©alis√© une premi√®re application PHP utilisant Symfony, et qui est
          capable de s&rsquo;interfacer avec une base de donn√©es relationnelles.
        </p>

        <p>
          Bravo.
        </p>

        <p>
          Allons plus loin pour progresser un peu dans notre connaissance de PHP, et de
          Symfony.
        </p>
      </div>

      <div id="outline-container-org318dc5d" class="outline-3">
        <h3 id="org318dc5d">√âtape 4-a : Ajout de l&rsquo;affichage des recommendations d&rsquo;un film</h3>
        <div class="outline-text-3" id="text-org318dc5d">
          <p>
            Ajoutez, comme pr√©c√©damment, une nouvelle commande <code>app:show-film</code> qui
            affiche un film et ses recommendations, en utilisant le g√©n√©rateur
            <code>make:command</code>.
          </p>

          <p>
            Cette commande attend cette fois deux arguments : titre du film et ann√©e. Vous pouvez vous
            inspirer du code ci-dessous pour l&rsquo;affichage des recommendations d&rsquo;un
            film :
          </p>

          <div class="org-src-container">
            <pre class="src src-php"><span style="color: #483d8b;">&lt;?php</span>


<span style="color: #a020f0;">class</span> <span style="color: #228b22;">ShowFilmCommand</span> <span style="color: #a020f0;">extends</span> <span style="color: #228b22;">Command</span>
{
    <span style="color: #b22222;">//</span><span style="color: #b22222;">...</span>

    <span style="color: #a020f0;">protected</span> <span style="color: #a020f0;">function</span> <span style="color: #0000ff;">configure</span>()
    {
    <span style="color: #008b8b;">$</span><span style="color: #008b8b;">this</span>
        <span style="color: #000000; background-color: #ffffff;">-&gt;</span><span style="color: #000000; background-color: #ffffff;">setDescription</span>(<span style="color: #8b2252;">'Show recommendations for a film'</span>)            
        <span style="color: #000000; background-color: #ffffff;">-&gt;</span><span style="color: #000000; background-color: #ffffff;">addArgument</span>(<span style="color: #8b2252;">'title'</span>, <span style="color: #008b8b;">InputArgument</span><span style="color: #000000; background-color: #ffffff;">::</span><span style="color: #008b8b;">REQUIRED</span>, <span style="color: #8b2252;">'Title of the film (spaces must be quoted)'</span>)
        <span style="color: #000000; background-color: #ffffff;">-&gt;</span><span style="color: #000000; background-color: #ffffff;">addArgument</span>(<span style="color: #8b2252;">'year'</span>, <span style="color: #008b8b;">InputArgument</span><span style="color: #000000; background-color: #ffffff;">::</span><span style="color: #008b8b;">REQUIRED</span>, <span style="color: #8b2252;">'Year of the film'</span>)
    ;
    }

    <span style="color: #a020f0;">protected</span> <span style="color: #a020f0;">function</span> <span style="color: #0000ff;">execute</span>(<span style="color: #228b22;">InputInterface</span> <span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">input</span>, <span style="color: #228b22;">OutputInterface</span> <span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">output</span>)
    {
    <span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">title</span> = <span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">input</span><span style="color: #000000; background-color: #ffffff;">-&gt;</span><span style="color: #000000; background-color: #ffffff;">getArgument</span>(<span style="color: #8b2252;">'title'</span>);
    <span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">year</span> = <span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">input</span><span style="color: #000000; background-color: #ffffff;">-&gt;</span><span style="color: #000000; background-color: #ffffff;">getArgument</span>(<span style="color: #8b2252;">'year'</span>);

    <span style="color: #a020f0;">if</span>(<span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">year</span> &amp;&amp; ! preg_match( <span style="color: #8b2252;">'/^\d+$/'</span>, <span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">year</span> ) ) {
        <span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">output</span><span style="color: #000000; background-color: #ffffff;">-&gt;</span><span style="color: #000000; background-color: #ffffff;">writeln</span>(<span style="color: #8b2252;">'&lt;error&gt;second argument must be integer&lt;/error&gt;'</span>);
        <span style="color: #a020f0;">exit</span>(2);
    }

    <span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">film</span> = <span style="color: #008b8b;">$</span><span style="color: #008b8b;">this</span><span style="color: #000000; background-color: #ffffff;">-&gt;</span><span style="color: #a0522d;">filmRepository</span><span style="color: #000000; background-color: #ffffff;">-&gt;</span><span style="color: #000000; background-color: #ffffff;">findOneBy</span>(
        [<span style="color: #8b2252;">'year'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">year</span>,
         <span style="color: #8b2252;">'title'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">title</span>]);
    <span style="color: #a020f0;">if</span>(!<span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">film</span>) {
        <span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">output</span><span style="color: #000000; background-color: #ffffff;">-&gt;</span><span style="color: #000000; background-color: #ffffff;">writeln</span>(<span style="color: #8b2252;">'unknown film: '</span> . <span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">title</span> . <span style="color: #8b2252;">' ('</span> . <span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">year</span> .<span style="color: #8b2252;">')'</span>);
        <span style="color: #a020f0;">exit</span>(1);
    }
    <span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">output</span><span style="color: #000000; background-color: #ffffff;">-&gt;</span><span style="color: #000000; background-color: #ffffff;">writeln</span>(<span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">film</span> . <span style="color: #8b2252;">':'</span>);

    <span style="color: #a020f0;">foreach</span>(<span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">film</span><span style="color: #000000; background-color: #ffffff;">-&gt;</span><span style="color: #000000; background-color: #ffffff;">getRecommendations</span>() <span style="color: #a020f0;">as</span> <span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">recommendation</span>) {
        <span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">output</span><span style="color: #000000; background-color: #ffffff;">-&gt;</span><span style="color: #000000; background-color: #ffffff;">writeln</span>(<span style="color: #8b2252;">'-'</span>. <span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">recommendation</span>);
    }
    }

    <span style="color: #b22222;">//</span><span style="color: #b22222;">...</span>
}

</pre>
          </div>

          <p>
            Testez :
          </p>
          <div class="org-src-container">
            <pre class="src src-sh">bin/console app:show-film coin 42
</pre>
          </div>

          <p>
            Vous devriez avoir une erreur par rapport √† l&rsquo;absence de
            <code>ShowFilmCommand::$filmRepository</code>. Recopiez, depuis le code existant dans
            <code>ListFilmsCommand.php</code>, les √©l√©ments correspondant
            √† l&rsquo;attribut et √† son initialisation dans le constructeur (cf. ci-dessus).
          </p>

          <p>
            Re-testez :
          </p>
          <pre class="example">
bin/console app:show-film coin 42
unknown film: coin (42)

</pre>

          <p>
            Bravo !
          </p>

          <p>
            Attention √† bien prot√©ger les arguments pass√©s √† la commande par le
            shell, via des quotes :
          </p>

          <div class="org-src-container">
            <pre class="src src-sh">bin/console app:show-film <span style="color: #8b2252;">"Fanfan la Tulipe"</span> 2003
</pre>
          </div>

          <p>
            √áa ne marche toujours pas ?
          </p>

          <p>
            Modifiez <code>Recommendation</code> pour ajouter la m√©thode <code>__toString()</code>
            triviale manquante.
          </p>

          <pre class="example">
bin/console app:show-film "Fanfan la Tulipe" 2003
Fanfan la Tulipe (2003):
-Mais pourquoi ???
</pre>
        </div>
      </div>

      <div id="outline-container-orgeec2331" class="outline-3">
        <h3 id="orgeec2331">√âtape 4-b : Am√©lioration des fonctionnalit√©s</h3>
        <div class="outline-text-3" id="text-orgeec2331">
          <p>
            On peut souhaiter tester diff√©rentes am√©liorations du code, que nous
            listons ici, mais qui sont optionnelles, pour aller plus loin, si vous
            avez termin√© le reste du travail.
          </p>
        </div>

        <div id="outline-container-org60b0f0b" class="outline-4">
          <h4 id="org60b0f0b">Affichage des films d&rsquo;une ann√©e</h4>
          <div class="outline-text-4" id="text-org60b0f0b">
            <p>
              Ajoutez l&rsquo;argument <code>year</code> √† <code>app:list-films</code> pour ne lister que les
              films d&rsquo;une ann√©e donn√©e
            </p>
          </div>

          <ul class="org-ul">
            <li><a id="orgec578ff"></a>Configuration des arguments et options<br>
              <div class="outline-text-5" id="text-orgec578ff">
                <p>
                  Modifiez <code>ListFilmsCommand::configure</code> pour permettre de filtrer
                </p>
                <div class="org-src-container">
                  <pre class="src src-php"><span style="color: #a020f0;">protected</span> <span style="color: #a020f0;">function</span> <span style="color: #0000ff;">configure</span>()
    {
    <span style="color: #008b8b;">$</span><span style="color: #008b8b;">this</span>
        <span style="color: #000000; background-color: #ffffff;">-&gt;</span><span style="color: #000000; background-color: #ffffff;">setDescription</span>(<span style="color: #8b2252;">'List films'</span>)
        <span style="color: #000000; background-color: #ffffff;">-&gt;</span><span style="color: #000000; background-color: #ffffff;">addArgument</span>(<span style="color: #8b2252;">'year'</span>, <span style="color: #008b8b;">InputArgument</span><span style="color: #000000; background-color: #ffffff;">::</span><span style="color: #008b8b;">OPTIONAL</span>, <span style="color: #8b2252;">'Filter films of a single year'</span>)
    ;
    }

</pre>
                </div>
              </div>
            </li>

            <li><a id="orgd6bba70"></a>Filtrage des films au chargement<br>
              <div class="outline-text-5" id="text-orgd6bba70">
                <p>
                  On peut utiliser ceci pour charger les films selon un crit√®re de
                  filtre :
                </p>
                <div class="org-src-container">
                  <pre class="src src-php"><span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">films</span> = <span style="color: #008b8b;">$</span><span style="color: #008b8b;">this</span><span style="color: #000000; background-color: #ffffff;">-&gt;</span><span style="color: #a0522d;">filmRepository</span><span style="color: #000000; background-color: #ffffff;">-&gt;</span><span style="color: #000000; background-color: #ffffff;">findBy</span>(
    [<span style="color: #8b2252;">'year'</span> =&gt; <span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">year</span>],
    [<span style="color: #8b2252;">'title'</span> =&gt; <span style="color: #8b2252;">'ASC'</span>]);
</pre>
                </div>

                <p>
                  Le premier tableau pass√© en argument de <code>findBy()</code> d√©finit les
                  crit√®res du filtre. Notez qu&rsquo;on a la possibilit√© de d√©finir plusieurs
                  crit√®res, comme dans l&rsquo;appel √† <code>findOneBy()</code> pr√©sent dans
                  <code>app:show-film</code>.
                </p>

                <p>
                  Le deuxi√®me argument de <code>findBy()</code> permet de sp√©cifier un crit√®re de
                  tri (optionnel), ici les titres par ordre croissant (<i>ASCending</i>).
                </p>
              </div>
            </li>
          </ul>
        </div>

        <div id="outline-container-org4a591bc" class="outline-4">
          <h4 id="org4a591bc">D√©doublonage des <i>remakes</i></h4>
          <div class="outline-text-4" id="text-org4a591bc">
            <p>
              On peut souhaiter ne lister les films qu&rsquo;une seule fois, quand il y a
              eu des <i>remakes</i>.
            </p>
          </div>

          <ul class="org-ul">
            <li><a id="orga314d4f"></a>Configuration des arguments et options<br>
              <div class="outline-text-5" id="text-orga314d4f">
                <div class="org-src-container">
                  <pre class="src src-php"><span style="color: #a020f0;">protected</span> <span style="color: #a020f0;">function</span> <span style="color: #0000ff;">configure</span>()
    {
    <span style="color: #008b8b;">$</span><span style="color: #008b8b;">this</span>
        <span style="color: #000000; background-color: #ffffff;">-&gt;</span><span style="color: #000000; background-color: #ffffff;">setDescription</span>(<span style="color: #8b2252;">'List films'</span>)
        <span style="color: #b22222;">//</span><span style="color: #b22222;">...</span>
        <span style="color: #000000; background-color: #ffffff;">-&gt;</span><span style="color: #000000; background-color: #ffffff;">addOption</span>(<span style="color: #8b2252;">'unique'</span>, <span style="color: #008b8b;">null</span>, <span style="color: #008b8b;">InputOption</span><span style="color: #000000; background-color: #ffffff;">::</span><span style="color: #008b8b;">VALUE_NONE</span>, <span style="color: #8b2252;">'Avoid listing remakes'</span>)
    ;
    }

</pre>
                </div>
              </div>
            </li>

            <li><a id="org8f9662d"></a>Filtrage unique des titres<br>
              <div class="outline-text-5" id="text-org8f9662d">
                <p>
                  Programmez un algorithme simple permettant de supprimer les
                  occurrences des multiples titres. Adaptez par exemple ce qui suit :
                </p>

                <div class="org-src-container">
                  <pre class="src src-php"><span style="color: #b22222;">// </span><span style="color: #b22222;">tableau PHP standard</span>
<span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">titles</span> = <span style="color: #a020f0;">array</span>();
<span style="color: #a020f0;">foreach</span>(<span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">films</span> <span style="color: #a020f0;">as</span> <span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">film</span>) {
    <span style="color: #b22222;">// </span><span style="color: #b22222;">ajout de valeurs au tableau</span>
    <span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">titles</span>[] = ...
}
<span style="color: #b22222;">// </span><span style="color: #b22222;">filtre pour ne garder que des valeurs uniques du tableau</span>
<span style="color: #a020f0;">print</span> array_unique(<span style="color: #000000; background-color: #ffffff;">$</span><span style="color: #a0522d;">titles</span>);
</pre>
                </div>
              </div>
            </li>
          </ul>
        </div>
      </div>


      <div id="outline-container-orgf86de9c" class="outline-3">
        <h3 id="orgf86de9c">Ajout contr√¥leur Web ?</h3>
        <div class="outline-text-3" id="text-orgf86de9c">
          <p>
            Mais au fait&#x2026; et le Web ?
          </p>

          <p>
            Le TP en Java avait comport√© une interface Web, accessible en
            HTTP&#x2026; alors, on est dans le cours sur le Web, et on s&rsquo;arr√™te √† la
            ligne de commande ?
          </p>

          <p>
            Patience.
          </p>

          <p>
            Nous passerons √† l&rsquo;√©tude des contr√¥leurs pour la gestion d&rsquo;HTTP dans
            Symfony dans les prochaines s√©quences du cours.
          </p>
        </div>
      </div>
    </div>

    <div id="outline-container-orgaea2b8b" class="outline-2">
      <h2 id="orgaea2b8b">√âvaluation</h2>
      <div class="outline-text-2" id="text-orgaea2b8b">
        <p>
          √Ä l&rsquo;issue de cette s√©ance vous avez travaill√© sur les √©l√©ments suivants :
        </p>

        <ul class="org-ul">
          <li>vous avez r√©alis√© l&rsquo;ex√©cution de programmes PHP en ligne de commande</li>
          <li>vous avez initi√© un projet Symfony √† partir d&rsquo;un squelette fourni</li>
          <li>vous comprenez certaines fonctions de l&rsquo;outil composer :
            <ul class="org-ul">
              <li>t√©l√©chargement des biblioth√®ques,</li>
              <li>gestion du chargement des classes par l&rsquo;<i>auto-loader</i>.</li>
            </ul>
          </li>
          <li>vous connaissez l&rsquo;outil <code>bin/console</code> qui est utilis√© par le
            d√©veloppeur Symfony en ligne de commande</li>
          <li>vous savez ajouter de nouvelles fonctions dans un programme Symfony</li>
          <li>vous avez identifi√© le r√¥le des instructions <code>namespace</code> et <code>use</code>
            permettant de structurer les espaces de noms des programmes PHP</li>
          <li>vous avez d√©couvert le mod√®le de donn√©es permettant de g√©rer en
            m√©moire des objets (classes objet g√©rant entit√©s du mod√®le de
            donn√©es avec Doctrine)</li>
          <li>vous avez utilis√© les g√©n√©rateurs de code facilitant l&rsquo;√©criture des programmes</li>
          <li>vous savez mettre au point des erreurs basiques sur les m√©canismes
            d&rsquo;acc√®s √† la base de donn√©es via Doctrine</li>
          <li>vous savez initialiser la base de donn√©es avec des donn√©es de test</li>
          <li>vous √™tes capables d&rsquo;identifier des modules diff√©rents du projet
            g√©rant respectivement une interface en ligne de commande
            (pr√©sentation) et l&rsquo;acc√®s aux donn√©es, du mod√®le d&rsquo;architecture en couches</li>
        </ul>
      </div>
    </div>
    <div id="footnotes">
      <h2 class="footnotes">Notes de bas de page: </h2>
      <div id="text-footnotes">

        <div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1">1</a></sup>
          <div class="footpara">
            <p class="footpara">
              En cas de besoin, il est possible d&rsquo;installer composer
              localement; cf. <a
                href="https://getcomposer.org/doc/00-intro.md#installation-linux-unix-osx">https://getcomposer.org/doc/00-intro.md#installation-linux-unix-osx</a>.
            </p>
          </div>
        </div>

        <div class="footdef"><sup><a id="fn.2" class="footnum" href="#fnr.2">2</a></sup>
          <div class="footpara">
            <p class="footpara">
              Sinon, installez <code>php-xml</code> (par ex. via <code>sudo apt install
php-xml</code> sur Ubuntu)
            </p>
          </div>
        </div>

        <div class="footdef"><sup><a id="fn.3" class="footnum" href="#fnr.3">3</a></sup>
          <div class="footpara">
            <p class="footpara">
              Sinon, installez <code>php-sqlite3</code> (par ex. via <code>sudo apt install
php-sqlite3</code> sur Ubuntu)
            </p>
          </div>
        </div>

        <div class="footdef"><sup><a id="fn.4" class="footnum" href="#fnr.4">4</a></sup>
          <div class="footpara">
            <p class="footpara">
              On peut aussi effectuer la m√™me op√©ration, en s√©lectionnant le
              projet dans l&rsquo;explorateur de projet, et en s√©lectionnant le menu de bouton
              droit &laquo;&nbsp;<i>Configure &gt; Add Doctrine Support</i>&nbsp;&raquo;.
            </p>
          </div>
        </div>


      </div>
    </div>
  </div>
  <div id="postamble" class="status">
    <p class="author">Auteur: Olivier Berger (TSP)</p>
    <p class="date">Created: 2020-09-21 Mon 15:21</p>
    <p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
  </div>
</body>

</html>
